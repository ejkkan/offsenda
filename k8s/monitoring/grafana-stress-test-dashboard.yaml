apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-stress-test-dashboard
  namespace: monitoring
data:
  stress-test.json: |
    {
      "annotations": { "list": [] },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 1,
      "id": null,
      "links": [],
      "liveNow": true,
      "panels": [
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
          "id": 1,
          "panels": [],
          "title": "System Overview - Key Metrics",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 500 }, { "color": "red", "value": 1000 }] },
              "unit": "reqps"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 0, "y": 1 },
          "id": 2,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(emails_sent_total[1m]))", "refId": "A" }],
          "title": "Throughput (emails/sec)",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "blue", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 4, "y": 1 },
          "id": 3,
          "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(emails_sent_total)", "refId": "A" }],
          "title": "Total Sent",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "decimals": 2,
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 1 }, { "color": "red", "value": 5 }] },
              "unit": "percent"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 8, "y": 1 },
          "id": 4,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(emails_sent_total{status=\"failed\"}[5m])) / sum(rate(emails_sent_total[5m])) * 100 or vector(0)", "refId": "A" }],
          "title": "Error Rate %",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 1000 }, { "color": "red", "value": 10000 }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 12, "y": 1 },
          "id": 5,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(nats_emails_enqueued_total) - sum(nats_emails_processed_total) or vector(0)", "refId": "A" }],
          "title": "Queue Backlog",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "purple", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 16, "y": 1 },
          "id": 6,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "count(kube_pod_info{namespace=\"batchsender\", pod=~\"worker.*\"})", "refId": "A" }],
          "title": "Worker Pods",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 20, "y": 1 },
          "id": 7,
          "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "batches_in_progress", "refId": "A" }],
          "title": "Active Batches",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "reqps"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 5 },
          "id": 8,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(emails_sent_total[1m]))", "legendFormat": "Emails Sent/sec", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(nats_emails_enqueued_total[1m]))", "legendFormat": "Enqueued/sec", "refId": "B" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(nats_emails_processed_total[1m]))", "legendFormat": "Processed/sec", "refId": "C" }
          ],
          "title": "Throughput Over Time",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 5 },
          "id": 9,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(nats_emails_enqueued_total) - sum(nats_emails_processed_total)", "legendFormat": "Queue Backlog", "refId": "A" }
          ],
          "title": "Queue Backlog Over Time",
          "type": "timeseries"
        },

        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 13 },
          "id": 200,
          "panels": [],
          "title": "Worker Lifecycle & Recovery",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 2 }, { "color": "red", "value": 5 }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 0, "y": 14 },
          "id": 201,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(worker_startups_total)", "refId": "A" }],
          "title": "Worker Restarts",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 4, "y": 14 },
          "id": 202,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(batches_recovered_total)", "refId": "A" }],
          "title": "Batches Recovered",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 1 }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 8, "y": 14 },
          "id": 203,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(batches_stuck)", "refId": "A" }],
          "title": "Batches Stuck",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "s"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 12, "y": 14 },
          "id": 204,
          "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "time() - min(worker_start_timestamp_seconds)", "refId": "A" }],
          "title": "Worker Uptime",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 8, "w": 8, "x": 16, "y": 14 },
          "id": 205,
          "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "none" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(worker_startups_total[5m])) * 60", "legendFormat": "Restarts/min", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(batches_recovered_total[5m])) * 60", "legendFormat": "Recovered/min", "refId": "B" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "batches_stuck", "legendFormat": "Stuck Now", "refId": "C" }
          ],
          "title": "Recovery Activity Over Time",
          "type": "timeseries"
        },

        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 22 },
          "id": 100,
          "panels": [],
          "title": "Bottleneck Identification - Where Things Break",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 8, "w": 8, "x": 0, "y": 14 },
          "id": 101,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "nats_queue_depth_batch_processor", "legendFormat": "Batch Queue", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "nats_queue_depth_email_processor", "legendFormat": "Email Queue", "refId": "B" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "nats_queue_depth_total", "legendFormat": "Total", "refId": "C" }
          ],
          "title": "NATS Queue Depths (piling up = bottleneck)",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 8, "w": 8, "x": 8, "y": 14 },
          "id": 102,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(provider_rate_limit_hits_total[1m])) by (provider)", "legendFormat": "{{provider}} hits", "refId": "A" }
          ],
          "title": "Rate Limit Hits (spiking = provider bottleneck)",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "percentunit"
            }
          },
          "gridPos": { "h": 8, "w": 8, "x": 16, "y": 14 },
          "id": 103,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "dragonfly_memory_ratio{instance=\"critical\"}", "legendFormat": "Dragonfly Critical", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "dragonfly_memory_ratio{instance=\"auxiliary\"}", "legendFormat": "Dragonfly Auxiliary", "refId": "B" }
          ],
          "title": "Dragonfly Memory % (high = memory bottleneck)",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [
                { "options": { "0": { "color": "green", "index": 0, "text": "CLOSED" }, "1": { "color": "yellow", "index": 1, "text": "HALF-OPEN" }, "2": { "color": "red", "index": 2, "text": "OPEN" } }, "type": "value" }
              ],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 1 }, { "color": "red", "value": 2 }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 0, "y": 22 },
          "id": 104,
          "options": { "colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "dragonfly_circuit_breaker_state{component=\"hot-state\"}", "refId": "A" }],
          "title": "Circuit Breaker: Hot State",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [
                { "options": { "0": { "color": "green", "index": 0, "text": "CLOSED" }, "1": { "color": "yellow", "index": 1, "text": "HALF-OPEN" }, "2": { "color": "red", "index": 2, "text": "OPEN" } }, "type": "value" }
              ],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 1 }, { "color": "red", "value": 2 }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 4, "y": 22 },
          "id": 105,
          "options": { "colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "dragonfly_circuit_breaker_state{component=\"rate-limit\"}", "refId": "A" }],
          "title": "Circuit Breaker: Rate Limit",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 1 }, { "color": "red", "value": 10 }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 8, "y": 22 },
          "id": 106,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "batches_rejected_memory_pressure_total", "refId": "A" }],
          "title": "Batches Rejected (Backpressure)",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 1 }, { "color": "red", "value": 5 }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 12, "y": 22 },
          "id": 107,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "batches_stuck", "refId": "A" }],
          "title": "Stuck Batches",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 16, "y": 22 },
          "id": 108,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(enqueue_failures_total[5m]))", "refId": "A" }],
          "title": "Enqueue Failures/sec",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 20, "y": 22 },
          "id": 109,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(buffer_items_dropped_total[5m]))", "refId": "A" }],
          "title": "Buffer Drops/sec",
          "type": "stat"
        },

        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 26 },
          "id": 200,
          "panels": [],
          "title": "NATS Message Queue - Deep Dive",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "reqps"
            }
          },
          "gridPos": { "h": 8, "w": 8, "x": 0, "y": 27 },
          "id": 201,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(gnatsd_varz_in_msgs[1m]))", "legendFormat": "Messages In/sec", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(gnatsd_varz_out_msgs[1m]))", "legendFormat": "Messages Out/sec", "refId": "B" }
          ],
          "title": "NATS Message Rate",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "Bps"
            }
          },
          "gridPos": { "h": 8, "w": 8, "x": 8, "y": 27 },
          "id": 202,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(gnatsd_varz_in_bytes[1m]))", "legendFormat": "Bytes In/sec", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(gnatsd_varz_out_bytes[1m]))", "legendFormat": "Bytes Out/sec", "refId": "B" }
          ],
          "title": "NATS Throughput (bytes)",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "bytes"
            }
          },
          "gridPos": { "h": 8, "w": 8, "x": 16, "y": 27 },
          "id": 203,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(gnatsd_varz_jetstream_stats_storage)", "legendFormat": "Storage Used", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(gnatsd_varz_jetstream_stats_memory)", "legendFormat": "Memory Used", "refId": "B" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "max(gnatsd_varz_jetstream_config_max_storage)", "legendFormat": "Max Storage", "refId": "C" }
          ],
          "title": "JetStream Storage & Memory",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 3, "x": 0, "y": 35 },
          "id": 204,
          "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "gnatsd_varz_jetstream_meta_cluster_size", "refId": "A" }],
          "title": "Cluster Size",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 3, "x": 3, "y": 35 },
          "id": 205,
          "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(gnatsd_varz_connections)", "refId": "A" }],
          "title": "Connections",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 3, "x": 6, "y": 35 },
          "id": 206,
          "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(gnatsd_varz_subscriptions)", "refId": "A" }],
          "title": "Subscriptions",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "percent"
            }
          },
          "gridPos": { "h": 4, "w": 7, "x": 9, "y": 35 },
          "id": 207,
          "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "right", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "gnatsd_varz_cpu", "legendFormat": "{{server_id}}", "refId": "A" }],
          "title": "NATS CPU by Pod",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "bytes"
            }
          },
          "gridPos": { "h": 4, "w": 8, "x": 16, "y": 35 },
          "id": 208,
          "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "right", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "gnatsd_varz_mem", "legendFormat": "{{server_id}}", "refId": "A" }],
          "title": "NATS Memory by Pod",
          "type": "timeseries"
        },

        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 39 },
          "id": 300,
          "panels": [],
          "title": "Dragonfly (Redis) - State & Rate Limiting",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "bytes"
            }
          },
          "gridPos": { "h": 8, "w": 8, "x": 0, "y": 40 },
          "id": 301,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "dragonfly_memory_used_bytes{instance=\"critical\"}", "legendFormat": "Critical Used", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "dragonfly_memory_max_bytes{instance=\"critical\"}", "legendFormat": "Critical Max", "refId": "B" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "dragonfly_memory_used_bytes{instance=\"auxiliary\"}", "legendFormat": "Auxiliary Used", "refId": "C" }
          ],
          "title": "Dragonfly Memory Usage",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 8, "w": 8, "x": 8, "y": 40 },
          "id": 302,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "provider_rate_limit_tokens", "legendFormat": "{{provider}}", "refId": "A" }
          ],
          "title": "Rate Limit Tokens Available",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "s"
            }
          },
          "gridPos": { "h": 8, "w": 8, "x": 16, "y": 40 },
          "id": 303,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "histogram_quantile(0.50, sum(rate(provider_rate_limit_wait_duration_seconds_bucket[1m])) by (le, provider))", "legendFormat": "{{provider}} p50", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "histogram_quantile(0.95, sum(rate(provider_rate_limit_wait_duration_seconds_bucket[1m])) by (le, provider))", "legendFormat": "{{provider}} p95", "refId": "B" }
          ],
          "title": "Rate Limit Wait Duration",
          "type": "timeseries"
        },

        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 48 },
          "id": 400,
          "panels": [],
          "title": "Worker Performance & Latency",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "s"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 49 },
          "id": 401,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "histogram_quantile(0.50, sum(rate(email_send_duration_seconds_bucket[1m])) by (le))", "legendFormat": "p50", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "histogram_quantile(0.95, sum(rate(email_send_duration_seconds_bucket[1m])) by (le))", "legendFormat": "p95", "refId": "B" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "histogram_quantile(0.99, sum(rate(email_send_duration_seconds_bucket[1m])) by (le))", "legendFormat": "p99", "refId": "C" }
          ],
          "title": "Email Send Latency (p50/p95/p99)",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "s"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 49 },
          "id": 402,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "histogram_quantile(0.50, sum(rate(nats_message_processing_duration_seconds_bucket[1m])) by (le))", "legendFormat": "p50", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "histogram_quantile(0.95, sum(rate(nats_message_processing_duration_seconds_bucket[1m])) by (le))", "legendFormat": "p95", "refId": "B" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "histogram_quantile(0.99, sum(rate(nats_message_processing_duration_seconds_bucket[1m])) by (le))", "legendFormat": "p99", "refId": "C" }
          ],
          "title": "NATS Message Processing Latency",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 1, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "percent"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 57 },
          "id": 403,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(container_cpu_usage_seconds_total{namespace=\"batchsender\", pod=~\"worker.*\"}[1m])) by (pod) * 100", "legendFormat": "{{pod}}", "refId": "A" }],
          "title": "Worker CPU % by Pod",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 1, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "bytes"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 57 },
          "id": 404,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(container_memory_working_set_bytes{namespace=\"batchsender\", pod=~\"worker.*\"}) by (pod)", "legendFormat": "{{pod}}", "refId": "A" }],
          "title": "Worker Memory by Pod",
          "type": "timeseries"
        },

        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 65 },
          "id": 500,
          "panels": [],
          "title": "Auto-Scaling & Capacity",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "stepAfter", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 66 },
          "id": 501,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "count(kube_pod_info{namespace=\"batchsender\", pod=~\"worker.*\"})", "legendFormat": "Current Pods", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "kube_horizontalpodautoscaler_spec_min_replicas{namespace=\"batchsender\", horizontalpodautoscaler=\"worker\"}", "legendFormat": "HPA Min", "refId": "B" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "kube_horizontalpodautoscaler_spec_max_replicas{namespace=\"batchsender\", horizontalpodautoscaler=\"worker\"}", "legendFormat": "HPA Max", "refId": "C" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "kube_horizontalpodautoscaler_status_desired_replicas{namespace=\"batchsender\", horizontalpodautoscaler=\"worker\"}", "legendFormat": "HPA Desired", "refId": "D" }
          ],
          "title": "Worker Pod Scaling",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "percentunit"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 66 },
          "id": 502,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(container_cpu_usage_seconds_total{namespace=\"batchsender\", pod=~\"worker.*\"}[5m])) / sum(kube_pod_container_resource_requests{namespace=\"batchsender\", pod=~\"worker.*\", resource=\"cpu\"})", "legendFormat": "CPU Utilization", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(container_memory_working_set_bytes{namespace=\"batchsender\", pod=~\"worker.*\"}) / sum(kube_pod_container_resource_requests{namespace=\"batchsender\", pod=~\"worker.*\", resource=\"memory\"})", "legendFormat": "Memory Utilization", "refId": "B" }
          ],
          "title": "Worker Resource Utilization vs Requests",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 0, "y": 74 },
          "id": 503,
          "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "count(kube_node_info)", "refId": "A" }],
          "title": "Cluster Nodes",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 4, "y": 74 },
          "id": 504,
          "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "count(kube_pod_info{namespace=\"batchsender\", pod=~\"nats.*\"})", "refId": "A" }],
          "title": "NATS Pods",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 4, "x": 8, "y": 74 },
          "id": 505,
          "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "count(kube_pod_info{namespace=\"batchsender\", pod=~\"dragonfly.*\"})", "refId": "A" }],
          "title": "Dragonfly Pods",
          "type": "stat"
        },

        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 78 },
          "id": 600,
          "panels": [],
          "title": "Database Health",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "s"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 79 },
          "id": 601,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "histogram_quantile(0.50, sum(rate(postgres_query_duration_seconds_bucket[1m])) by (le))", "legendFormat": "p50", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "histogram_quantile(0.95, sum(rate(postgres_query_duration_seconds_bucket[1m])) by (le))", "legendFormat": "p95", "refId": "B" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "histogram_quantile(0.99, sum(rate(postgres_query_duration_seconds_bucket[1m])) by (le))", "legendFormat": "p99", "refId": "C" }
          ],
          "title": "PostgreSQL Query Latency",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "s"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 79 },
          "id": 602,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "histogram_quantile(0.50, sum(rate(clickhouse_insert_duration_seconds_bucket[1m])) by (le))", "legendFormat": "p50", "refId": "A" },
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "histogram_quantile(0.95, sum(rate(clickhouse_insert_duration_seconds_bucket[1m])) by (le))", "legendFormat": "p95", "refId": "B" }
          ],
          "title": "ClickHouse Insert Latency",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "normal" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 87 },
          "id": 603,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(clickhouse_events_total[1m])) by (event_type)", "legendFormat": "{{event_type}}", "refId": "A" }
          ],
          "title": "ClickHouse Events by Type (rate/sec)",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 87 },
          "id": 604,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(clickhouse_write_failures_total[5m])) by (operation)", "legendFormat": "{{operation}} failures", "refId": "A" }
          ],
          "title": "ClickHouse Write Failures",
          "type": "timeseries"
        },

        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 95 },
          "id": 700,
          "panels": [],
          "title": "Error Breakdown - What's Failing",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "normal" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 8, "w": 8, "x": 0, "y": 96 },
          "id": 701,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(email_errors_total[1m])) by (error_type)", "legendFormat": "{{error_type}}", "refId": "A" }
          ],
          "title": "Email Errors by Type",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "normal" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 8, "w": 8, "x": 8, "y": 96 },
          "id": 702,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(email_errors_total[1m])) by (provider)", "legendFormat": "{{provider}}", "refId": "A" }
          ],
          "title": "Email Errors by Provider",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "normal" }, "thresholdsStyle": { "mode": "off" } },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 8, "w": 8, "x": 16, "y": 96 },
          "id": 703,
          "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "targets": [
            { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(enqueue_failures_total[1m])) by (queue)", "legendFormat": "{{queue}}", "refId": "A" }
          ],
          "title": "Enqueue Failures by Queue",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 6, "x": 0, "y": 104 },
          "id": 704,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(email_errors_total{error_type=\"transient\"})", "refId": "A" }],
          "title": "Total Transient Errors",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 6, "x": 6, "y": 104 },
          "id": 705,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(email_errors_total{error_type=\"rate_limit\"})", "refId": "A" }],
          "title": "Total Rate Limit Errors",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 6, "x": 12, "y": 104 },
          "id": 706,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(email_errors_total{error_type=\"permanent\"})", "refId": "A" }],
          "title": "Total Permanent Errors",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "blue", "value": null }] },
              "unit": "short"
            }
          },
          "gridPos": { "h": 4, "w": 6, "x": 18, "y": 104 },
          "id": 707,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "batches_recovered_total", "refId": "A" }],
          "title": "Batches Recovered",
          "type": "stat"
        },

        {
          "collapsed": true,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 108 },
          "id": 800,
          "panels": [
            {
              "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
              "fieldConfig": {
                "defaults": {
                  "color": { "mode": "palette-classic" },
                  "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
                  "mappings": [],
                  "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
                  "unit": "reqps"
                }
              },
              "gridPos": { "h": 8, "w": 12, "x": 0, "y": 109 },
              "id": 801,
              "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
              "targets": [
                { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "sum(rate(webhooks_received_total[1m])) by (provider)", "legendFormat": "{{provider}} received", "refId": "A" }
              ],
              "title": "Webhooks Received/sec",
              "type": "timeseries"
            },
            {
              "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
              "fieldConfig": {
                "defaults": {
                  "color": { "mode": "palette-classic" },
                  "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
                  "mappings": [],
                  "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
                  "unit": "short"
                }
              },
              "gridPos": { "h": 8, "w": 12, "x": 12, "y": 109 },
              "id": 802,
              "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
              "targets": [
                { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "webhook_queue_depth", "legendFormat": "Queue Depth", "refId": "A" }
              ],
              "title": "Webhook Queue Depth",
              "type": "timeseries"
            }
          ],
          "title": "Webhooks (collapsed)",
          "type": "row"
        }
      ],
      "refresh": "5s",
      "schemaVersion": 39,
      "style": "dark",
      "tags": ["stress-test", "performance", "bottleneck", "nats", "dragonfly"],
      "templating": { "list": [] },
      "time": { "from": "now-15m", "to": "now" },
      "timepicker": {},
      "timezone": "browser",
      "title": "Stress Testing - Find Breaking Points",
      "uid": "stress-test",
      "version": 1
    }
