apiVersion: v1
kind: ConfigMap
metadata:
  name: worker-config
  namespace: batchsender
data:
  # Email provider (mock, resend, ses)
  EMAIL_PROVIDER: "mock"

  # Node environment
  NODE_ENV: "development"

  # Service URLs (use kubernetes service DNS)
  DRAGONFLY_URL: "dragonfly.batchsender.svc:6379"
  NATS_CLUSTER: "nats://nats.batchsender.svc:4222"
  CLICKHOUSE_URL: "http://clickhouse.batchsender.svc:8123"

  # NATS TLS (enabled in production overlay)
  NATS_TLS_ENABLED: "false"
  NATS_TLS_CA_FILE: "/etc/nats-certs/ca.crt"
  CLICKHOUSE_DATABASE: "batchsender"
  CLICKHOUSE_USER: "default"

  # Worker settings
  WORKER_CONCURRENCY: "10"
  LOG_LEVEL: "info"

  # Batch Recovery (auto-fix stuck batches)
  BATCH_RECOVERY_ENABLED: "true"
  BATCH_RECOVERY_INTERVAL_MS: "300000"
  BATCH_RECOVERY_THRESHOLD_MS: "900000"

  # Webhook Resilience (retry + circuit breaker)
  WEBHOOK_TIMEOUT_MS: "30000"
  WEBHOOK_MAX_RETRIES: "3"
  WEBHOOK_CIRCUIT_BREAKER_ENABLED: "true"

  # Audit Logging
  AUDIT_ENABLED: "true"
  AUDIT_LOG_TO_CONSOLE: "false"
# Updated Fri Jan 17 2026
