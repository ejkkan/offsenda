apiVersion: v1
kind: ConfigMap
metadata:
  name: clickhouse-keeper-config
  namespace: batchsender
data:
  keeper.xml: |
    <clickhouse>
        <keeper_server>
            <tcp_port>9181</tcp_port>
            <server_id>1</server_id>
            <log_storage_path>/var/lib/clickhouse/coordination/log</log_storage_path>
            <snapshot_storage_path>/var/lib/clickhouse/coordination/snapshots</snapshot_storage_path>

            <coordination_settings>
                <operation_timeout_ms>10000</operation_timeout_ms>
                <session_timeout_ms>30000</session_timeout_ms>
                <raft_logs_level>warning</raft_logs_level>
            </coordination_settings>

            <!-- Single node for now. Add more servers when scaling to 3 replicas:
            <raft_configuration>
                <server><id>1</id><hostname>clickhouse-0.clickhouse-headless...</hostname><port>9234</port></server>
                <server><id>2</id><hostname>clickhouse-1.clickhouse-headless...</hostname><port>9234</port></server>
                <server><id>3</id><hostname>clickhouse-2.clickhouse-headless...</hostname><port>9234</port></server>
            </raft_configuration>
            -->
            <raft_configuration>
                <server>
                    <id>1</id>
                    <hostname>clickhouse-0.clickhouse-headless.batchsender.svc.cluster.local</hostname>
                    <port>9234</port>
                </server>
            </raft_configuration>
        </keeper_server>
    </clickhouse>
