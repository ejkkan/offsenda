apiVersion: v1
kind: ConfigMap
metadata:
  name: nats-config
  namespace: batchsender
data:
  nats.conf: |
    # NATS Server Configuration with TLS (Production 3-node cluster - Falkenstein)

    # Server identification
    server_name: $POD_NAME

    # Client connections (TLS)
    port: 4222
    tls {
      cert_file: /etc/nats-certs/tls.crt
      key_file: /etc/nats-certs/tls.key
      ca_file: /etc/nats-certs/ca.crt
      verify: false  # Don't require client certs
      timeout: 2
    }

    # Cluster connections (TLS between NATS nodes in same region)
    cluster {
      name: falkenstein
      port: 6222

      tls {
        cert_file: /etc/nats-certs/tls.crt
        key_file: /etc/nats-certs/tls.key
        ca_file: /etc/nats-certs/ca.crt
        verify: true
        timeout: 2
      }

      routes: [
        nats://nats-0.nats.batchsender.svc:6222
        nats://nats-1.nats.batchsender.svc:6222
        nats://nats-2.nats.batchsender.svc:6222
      ]
    }

    # Gateway connections (cross-region) - disabled until Ashburn is deployed
    # Re-enable when setting up multi-region

    # JetStream storage
    jetstream {
      store_dir: /data
      max_mem: 2G
      max_file: 40G
    }

    # Monitoring endpoint (no TLS for internal metrics scraping)
    http_port: 8222

    # Logging
    debug: false
    trace: false
    logtime: true
