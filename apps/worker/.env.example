# BatchSender Worker Configuration
# Copy this to .env and configure for your environment

# Database (PostgreSQL)
DATABASE_URL="postgresql://user:password@localhost:5432/batchsender"

# NATS JetStream (Message Queue)
NATS_CLUSTER="nats://localhost:4222"
NATS_REPLICAS=1

# ClickHouse (Analytics & Event Storage)
CLICKHOUSE_URL="http://localhost:8123"
CLICKHOUSE_USER="default"
CLICKHOUSE_PASSWORD=""
CLICKHOUSE_DATABASE="batchsender"

# Dragonfly/Redis (Rate Limiting & Caching)
DRAGONFLY_URL="localhost:6379"

# Email Provider
# Options: "resend", "ses", "mock"
EMAIL_PROVIDER="mock"

# Resend Configuration (if EMAIL_PROVIDER="resend")
RESEND_API_KEY=""

# AWS SES Configuration (if EMAIL_PROVIDER="ses")
AWS_REGION="us-east-1"
AWS_ACCESS_KEY_ID=""
AWS_SECRET_ACCESS_KEY=""
# SES_ENDPOINT=""  # Optional: Override for mock server

# Mock Provider Settings (if EMAIL_PROVIDER="mock")
MOCK_MODE="success"  # Options: success, fail, random
MOCK_FAILURE_RATE=0.1
MOCK_LATENCY_MS=50

# Webhooks (for delivery/bounce notifications)
WEBHOOK_SECRET="your-webhook-secret-here"

# Server
PORT=6001

# Processing Settings
BATCH_SIZE=100
POLL_INTERVAL_MS=2000
RATE_LIMIT_PER_SECOND=100
CONCURRENT_BATCHES=10
MAX_CONCURRENT_EMAILS=50

# Provider Rate Limits (messages per second)
# IMPORTANT: Set these to match your actual provider limits
SES_RATE_LIMIT=14        # AWS SES default limit (update when AWS increases)
RESEND_RATE_LIMIT=100    # Resend default limit
MOCK_RATE_LIMIT=1000     # Mock provider (no real limit)

# Worker Scaling
WORKER_ID="worker-1"  # Unique ID for this worker instance

# Request Validation
MAX_REQUEST_SIZE_BYTES=10485760  # 10MB
RATE_LIMIT_PER_IP=100            # API requests per minute per IP
DISABLE_RATE_LIMIT=false         # Disable rate limiting (set to true for tests, false for production)

# Environment
NODE_ENV="development"  # Options: development, production, test

# ============================================================================
# QUICK START:
# ============================================================================
#
# 1. Copy this file:
#    cp .env.example .env
#
# 2. Choose your email provider and configure it:
#
#    For Mock (testing):
#      EMAIL_PROVIDER="mock"
#      (No other config needed)
#
#    For Resend:
#      EMAIL_PROVIDER="resend"
#      RESEND_API_KEY="re_..."
#      RESEND_RATE_LIMIT=100
#
#    For AWS SES:
#      EMAIL_PROVIDER="ses"
#      AWS_REGION="us-east-1"
#      AWS_ACCESS_KEY_ID="..."
#      AWS_SECRET_ACCESS_KEY="..."
#      SES_RATE_LIMIT=14  # Your actual AWS limit
#
# 3. Configure infrastructure:
#    - PostgreSQL: Update DATABASE_URL
#    - NATS: Update NATS_CLUSTER
#    - ClickHouse: Update CLICKHOUSE_* variables
#    - Dragonfly: Update DRAGONFLY_URL
#
# 4. Set webhook secret:
#    WEBHOOK_SECRET="$(openssl rand -hex 32)"
#
# 5. Start the worker:
#    pnpm dev
#
# ============================================================================
# RATE LIMITING:
# ============================================================================
#
# The system has TWO types of rate limiting:
#
# 1. API Rate Limiting (RATE_LIMIT_PER_IP):
#    - Protects your API from abuse
#    - Limits requests per minute per IP address
#
# 2. Provider Rate Limiting (SES_RATE_LIMIT, RESEND_RATE_LIMIT):
#    - Respects email provider sending limits
#    - Prevents AWS/Resend from throttling you
#    - Works across ALL worker instances (distributed)
#    - Update these when your limits increase
#
# Example: AWS SES
#   - New account: SES_RATE_LIMIT=14
#   - After increase: SES_RATE_LIMIT=50
#   - After another: SES_RATE_LIMIT=100
#
# The system automatically respects these limits!
#
# ============================================================================
