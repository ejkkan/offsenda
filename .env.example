# Database
# For local K8s dev: postgresql://batchsender:batchsender@localhost:5433/batchsender
# For production: Use your Neon/cloud database URL
DATABASE_URL="postgresql://batchsender:batchsender@localhost:5433/batchsender"
# =============================================================================
# Email Provider Configuration
# =============================================================================
# Options: "resend", "ses", "mock"
# Use "mock" for local development/testing without sending real emails
EMAIL_PROVIDER="mock"

# Resend API key (only required if EMAIL_PROVIDER="resend")
# Get key at: https://resend.com
RESEND_API_KEY=""

# Mock provider settings (only used when EMAIL_PROVIDER="mock")
# MOCK_MODE: "success" (always succeed), "fail" (always fail), "random" (configurable failure rate)
MOCK_MODE="success"
MOCK_FAILURE_RATE="0.1"
MOCK_LATENCY_MS="50"

# =============================================================================
# Web App (Next.js)
# =============================================================================
NEXTAUTH_SECRET="generate-a-random-secret-here"
NEXTAUTH_URL="http://localhost:3000"

# =============================================================================
# Worker
# =============================================================================
WEBHOOK_SECRET="generate-another-secret-here"

# =============================================================================
# Infrastructure (local Docker containers)
# =============================================================================
# NATS JetStream
NATS_CLUSTER="nats://localhost:4222"

# Dragonfly (distributed rate limiting)
DRAGONFLY_URL="localhost:6379"

# ClickHouse
CLICKHOUSE_URL="http://localhost:8123"
CLICKHOUSE_USER="default"
CLICKHOUSE_PASSWORD="clickhouse"
CLICKHOUSE_DATABASE="batchsender"

# Backblaze B2 Cold Storage (for ClickHouse tiered storage)
B2_KEY_ID=""
B2_APP_KEY=""
B2_BUCKET=""

# =============================================================================
# Monitoring (Grafana & Prometheus)
# =============================================================================
GRAFANA_ADMIN_PASSWORD="change-me-in-production"
PROMETHEUS_ADMIN_PASSWORD="change-me-in-production"

# =============================================================================
# Batch Recovery Service
# =============================================================================
# Automatically detects and recovers batches stuck in "processing" status
BATCH_RECOVERY_ENABLED="true"
BATCH_RECOVERY_INTERVAL_MS="300000"      # 5 minutes - how often to scan
BATCH_RECOVERY_THRESHOLD_MS="900000"     # 15 minutes - how old before considered stuck
BATCH_RECOVERY_MAX_PER_SCAN="100"        # Max batches to recover per scan

# =============================================================================
# Webhook Resilience
# =============================================================================
# Configures retry and circuit breaker for outgoing webhook calls
WEBHOOK_TIMEOUT_MS="30000"               # 30 seconds - request timeout
WEBHOOK_MAX_RETRIES="3"                  # Number of retry attempts
WEBHOOK_RETRY_BASE_DELAY_MS="1000"       # 1 second - initial retry delay
WEBHOOK_RETRY_MAX_DELAY_MS="10000"       # 10 seconds - max retry delay
WEBHOOK_CIRCUIT_BREAKER_ENABLED="true"   # Enable circuit breaker pattern
WEBHOOK_CIRCUIT_FAILURE_THRESHOLD="5"    # Failures before opening circuit
WEBHOOK_CIRCUIT_RESET_TIMEOUT_MS="30000" # 30 seconds - time before half-open

# =============================================================================
# Audit Logging
# =============================================================================
# Comprehensive audit logging for security and compliance
AUDIT_ENABLED="true"
AUDIT_LOG_TO_CONSOLE="false"             # Also log to console (verbose)
AUDIT_BATCH_SIZE="100"                   # Events to batch before flush
AUDIT_FLUSH_INTERVAL_MS="5000"           # 5 seconds - flush interval
